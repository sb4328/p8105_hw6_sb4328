Homework 6
================
Sanjana Batabyal

This is my solution to Homework 6.

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──

    ## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
    ## ✓ tibble  3.0.4     ✓ dplyr   1.0.2
    ## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
    ## ✓ readr   1.4.0     ✓ forcats 0.5.0

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(magrittr)
```

    ## 
    ## Attaching package: 'magrittr'

    ## The following object is masked from 'package:purrr':
    ## 
    ##     set_names

    ## The following object is masked from 'package:tidyr':
    ## 
    ##     extract

## Problem 1

Manipulating the dataset to our preferences. Creating a city\_state
variable. Creating a binary resolution variable. Removing cities that do
not report race from dataset.

``` r
homicide=
  read_csv("data/homicide-data.csv", na=c("", "NA", "Unknown")) %>%
  mutate(city_state=str_c(city, state, sep="_"),
         victim_age=as.numeric(victim_age),
    resolution=case_when(
    disposition=="Closed without arrest" ~ 0,
    disposition=="Closed by arrest" ~ 1,
    disposition=="Open/No arrest" ~ 0)) %>%
  filter(
    victim_race %in% c("White", "Black"),
    city_state != "Tulsa_AL", 
    city_state != "Dallas_TX",
    city_state != "Phoenix_AZ",
    city_state != "Kansas City_MO") %>%
  select(city_state, resolution, victim_age, victim_race, victim_sex)
```

    ## 
    ## ── Column specification ────────────────────────────────────────────────────────
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_double(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_double(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

Focusing on the city of Baltimore, MD.

``` r
baltimore=
  homicide %>% filter(city_state=="Baltimore_MD")

glm(resolution ~ victim_age + victim_race + victim_sex,
    data=baltimore,
    family=binomial()) %>%
  broom::tidy() %>%
  mutate(
    OR=exp(estimate),
    CI_lower=exp(estimate)-1.96*std.error,
    CI_upper=exp(estimate)+1.96*std.error
  ) %>%
  select(term, OR, starts_with("CI")) %>%
  knitr::kable(digits=3)
```

| term              |    OR | CI\_lower | CI\_upper |
| :---------------- | ----: | --------: | --------: |
| (Intercept)       | 1.363 |     1.028 |     1.699 |
| victim\_age       | 0.993 |     0.987 |     1.000 |
| victim\_raceWhite | 2.320 |     1.978 |     2.663 |
| victim\_sexMale   | 0.426 |     0.155 |     0.696 |

Applying this across all the remaining cities in the dataset.

``` r
hom_results=
homicide %>%
  nest(data = -city_state) %>%
  mutate(
    models=
      map(.x=data, 
          ~glm(resolution ~ victim_age + victim_race + victim_sex,
          data=.x,
          family=binomial())),
    results=map(models, broom::tidy)
  ) %>%
  select(city_state, results) %>%
  unnest(results) %>%
   mutate(
    OR=exp(estimate),
    CI_lower=exp(estimate)-1.96*std.error,
    CI_upper=exp(estimate)+1.96*std.error
  ) %>%
  select(term, OR, starts_with("CI"))
```

Creating a plot of hom\_results.

``` r
hom_results %>%
  filter(term == "victim_sexMale") %>%
  mutate(city_state = fct_reorder(city_state, OR)) %>%
  ggplot(aes(x=city_state, y=OR)) +
  geom_point() +
  geom_errorbar(aes(ymin=CI_lower, ymax=CI_upper)) +
  theme(axis.text.x=element_text(angle=90, hjust=1))
```

![](p8105_hw6_sb4328_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
\#\# Problem 2

\#\#Problem 3
